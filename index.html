<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>JAILEX HUD | All-In-One Edition</title>
  <style>
    /* ====== JAILEX NEON SCI-FI UI ====== */
    body { margin: 0; padding: 0; background: radial-gradient(circle at center, #02030a 0%, #000000 80%); color: #f5f5f5; font-family: system-ui, sans-serif; overflow: hidden; height: 100vh; }
    .app-container { display: flex; height: 100vh; }
    .sidebar { width: 240px; background: rgba(5,5,15,0.95); border-right: 1px solid rgba(255,255,255,0.15); display: flex; flex-direction: column; padding: 20px 12px; }
    .sidebar-title { font-weight: 800; font-size: 22px; color: #ff7a18; text-shadow: 0 0 10px #ff7a18; }
    .sidebar-sub { font-size: 10px; opacity: 0.5; margin-bottom: 20px; letter-spacing: 1px; }
    .tab-button { width: 100%; text-align: left; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(15,15,30,0.8); color: #ccc; cursor: pointer; font-weight: 600; }
    .tab-button.active { background: linear-gradient(135deg, rgba(255,122,24,0.9), rgba(0,200,255,0.7)); color: #fff; border-color: #fff; box-shadow: 0 0 20px rgba(255,122,24,0.6); }
    .main { flex: 1; overflow-y: auto; padding: 20px 30px; }
    .panel { backdrop-filter: blur(12px); background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 24px; margin-bottom: 24px; max-width: 900px; }
    .panel h2 { margin: 0 0 15px 0; color: #ff7a18; border-bottom: 1px solid rgba(255,122,24,0.3); padding-bottom: 10px; }
    button { padding: 10px 18px; border-radius: 8px; border: 1px solid #ff7a18; background: rgba(255,122,24,0.1); color: #ff7a18; cursor: pointer; font-weight: 700; margin: 5px; transition: 0.2s; }
    button:hover { background: #ff7a18; color: #000; box-shadow: 0 0 10px #ff7a18; }
    input, select { width: 100%; padding: 10px; margin-top: 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.6); color: #fff; box-sizing: border-box; }
    #chatLog { height: 350px; overflow-y: auto; font-family: 'Consolas', monospace; font-size: 14px; }
    .chat-line { margin-bottom: 8px; padding: 8px; background: rgba(255,255,255,0.03); border-radius: 6px; border-left: 3px solid #ff7a18; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }
    .status-pill { padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; }
    .status-on { color: #53fc18; border: 1px solid #53fc18; }
    .status-off { color: #ff3333; border: 1px solid #ff3333; }
  </style>
</head>
<body>

<div class="app-container">
  <div class="sidebar">
    <div class="sidebar-title">JAILEX HUD</div>
    <div class="sidebar-sub">ALL-IN-ONE SYSTEM</div>
    <button class="tab-button active" data-target="tab-playback">Playback</button>
    <button class="tab-button" data-target="tab-voices">Voices</button>
    <button class="tab-button" data-target="tab-chat">Chat Feed</button>
    <button class="tab-button" data-target="tab-timers">Timers</button>
    <button class="tab-button" data-target="tab-connections">Connections</button>
  </div>

  <div class="main">
    <div id="tab-playback" class="tab-panel active">
      <div class="panel">
        <h2>System Control</h2>
        <button id="enableAudioBtn">1. START ENGINE</button>
        <button id="playPauseBtn">PAUSE</button>
        <button id="testTtsBtn">TEST VOICE</button>
        <div style="margin-top:20px;">
          <label><input type="checkbox" id="readUsername" checked /> Read Usernames</label>
          <p style="font-weight: bold; margin-top: 15px;">
            Queue: <span id="queueLen" style="color:#00c8ff">0</span> | 
            Speaking: <span id="speakingNow" style="color:#53fc18">None</span>
          </p>
        </div>
      </div>
    </div>

    <div id="tab-voices" class="tab-panel">
      <div class="panel">
        <h2>Voice Settings</h2>
        <label>Kick Voice</label><select id="kickVoice"></select>
        <label>Timer Voice</label><select id="timerVoice"></select>
        <label>Volume</label><input type="range" id="volume" min="0" max="1" step="0.1" value="1">
      </div>
    </div>

    <div id="tab-chat" class="tab-panel">
      <div class="panel"><h2>Stream Feed</h2><div id="chatLog"></div></div>
    </div>

    <div id="tab-timers" class="tab-panel">
      <div class="panel">
        <h2>Timers</h2>
        <input type="text" id="timerMessageInput" placeholder="Alert message...">
        <button id="addTimerBtn">Add Timer</button>
        <div id="timersList"></div>
      </div>
    </div>

    <div id="tab-connections" class="tab-panel">
      <div class="panel">
        <h2>Connections</h2>
        <p>Kick: <span id="kickStatusPill" class="status-pill status-off">IDLE</span></p>
        <p>Twitch: <span id="twitchStatusPill" class="status-pill status-off">IDLE</span></p>
      </div>
    </div>
  </div>
</div>

<script>
/* ====== ALL-IN-ONE JAILEX LOGIC ====== */
const KICK_USER = "justquitbro7";
const TWITCH_USER = "justquitbro7";

// 1. STATE
window.queue = [];
window.isSpeaking = false;
window.audioEnabled = false;
window.isPlaying = true;
window.voices = [];

// 2. THE HUB (addMessage)
window.addMessage = function(msg) {
    const log = document.getElementById("chatLog");
    if (log) {
        const div = document.createElement("div");
        div.className = "chat-line";
        const color = msg.platform === "kick" ? "#53fc18" : "#a970ff";
        div.innerHTML = `<span style="color:${color};font-weight:600">[${msg.platform.toUpperCase()}] ${msg.username}:</span> ${msg.message}`;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
    }
    window.queue.push(msg);
    document.getElementById("queueLen").textContent = window.queue.length;
};

// 3. AUDIO ENGINE
function initVoices() {
    window.voices = speechSynthesis.getVoices();
    const kSelect = document.getElementById("kickVoice");
    const tSelect = document.getElementById("timerVoice");
    if (kSelect && tSelect && window.voices.length > 0) {
        kSelect.innerHTML = ""; tSelect.innerHTML = "";
        window.voices.forEach(v => {
            let opt = document.createElement("option");
            opt.value = v.name; opt.textContent = v.name;
            kSelect.appendChild(opt.cloneNode(true));
            tSelect.appendChild(opt.cloneNode(true));
        });
    } else { setTimeout(initVoices, 200); }
}
speechSynthesis.onvoiceschanged = initVoices;
initVoices();

setInterval(() => {
    if (!window.audioEnabled || !window.isPlaying || window.isSpeaking || window.queue.length === 0) return;
    const next = window.queue.shift();
    document.getElementById("queueLen").textContent = window.queue.length;
    document.getElementById("speakingNow").textContent = next.username;

    const readUser = document.getElementById("readUsername").checked;
    const text = readUser ? `${next.username} says ${next.message}` : next.message;

    window.isSpeaking = true;
    const utter = new SpeechSynthesisUtterance(text);
    utter.volume = parseFloat(document.getElementById("volume").value);
    
    const voiceName = next.platform === "kick" ? document.getElementById("kickVoice").value : document.getElementById("timerVoice").value;
    utter.voice = window.voices.find(v => v.name === voiceName);

    utter.onend = () => { window.isSpeaking = false; document.getElementById("speakingNow").textContent = "None"; };
    speechSynthesis.speak(utter);
}, 150);

// 4. UI HANDLERS
document.querySelectorAll(".tab-button").forEach(btn => {
    btn.onclick = () => {
        document.querySelectorAll(".tab-button").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tab-panel").forEach(p => p.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.getAttribute("data-target")).classList.add("active");
    };
});

document.getElementById("enableAudioBtn").onclick = () => {
    window.audioEnabled = true;
    speechSynthesis.speak(new SpeechSynthesisUtterance("Audio system online."));
};

document.getElementById("testTtsBtn").onclick = () => {
    if (!window.audioEnabled) return alert("Click Start Engine first!");
    window.addMessage({ platform: "kick", username: "System", message: "Audio system is working perfectly." });
};

// 5. KICK CONNECTION
async function initKick() {
    const pill = document.getElementById("kickStatusPill");
    try {
        const res = await fetch(`https://kick.com/api/v2/channels/${KICK_USER}`);
        const data = await res.json();
        const ws = new WebSocket("wss://ws-us2.pusher.com/app/32cbd69e4b950bf97679?protocol=7&client=js&version=8.4.0-rc2&flash=false");
        ws.onopen = () => {
            pill.textContent = "CONNECTED"; pill.className = "status-pill status-on";
            ws.send(JSON.stringify({ event: "pusher:subscribe", data: { channel: `chatrooms.${data.chatroom.id}.v2` } }));
        };
        ws.onmessage = (e) => {
            const msg = JSON.parse(e.data);
            if (msg.event === "App\\Events\\ChatMessageEvent") {
                const c = JSON.parse(msg.data);
                window.addMessage({ platform: "kick", username: c.sender.username, message: c.content });
            }
        };
        ws.onclose = () => { pill.textContent = "RECONNECTING"; setTimeout(initKick, 5000); };
    } catch (e) { setTimeout(initKick, 10000); }
}
initKick();

// 6. TWITCH CONNECTION
function initTwitch() {
    const pill = document.getElementById("twitchStatusPill");
    const ws = new WebSocket("wss://irc-ws.chat.twitch.tv:443");
    ws.onopen = () => {
        pill.textContent = "CONNECTED"; pill.className = "status-pill status-on";
        ws.send("NICK justinfan12345");
        ws.send(`JOIN #${TWITCH_USER.toLowerCase()}`);
    };
    ws.onmessage = (e) => {
        if (e.data.includes("PRIVMSG")) {
            const parts = e.data.split("PRIVMSG")[1].split(":");
            const user = e.data.match(/:(\w+)!/)[1];
            window.addMessage({ platform: "twitch", username: user, message: parts[1].trim() });
        }
        if (e.data.startsWith("PING")) ws.send("PONG :tmi.twitch.tv");
    };
    ws.onclose = () => { pill.textContent = "IDLE"; setTimeout(initTwitch, 5000); };
}
initTwitch();
</script>
</body>
</html>
