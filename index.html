<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jailex - Streaming Made Easy</title>
    <style>
        /* --- MASTER BEARS THEME --- */
        body { 
            background-color: #0B162A; /* Bears Navy */
            color: #FFFFFF; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            display: flex; 
            height: 100vh; 
            overflow: hidden; 
        }

        /* Sidebar Navigation */
        .sidebar { 
            width: 260px; 
            background-color: #070D19; 
            border-right: 4px solid #C83803; /* Bears Orange */
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
        }

        .sidebar h1 { 
            color: #C83803; 
            font-size: 2rem; 
            text-align: center; 
            margin-bottom: 40px; 
            letter-spacing: 3px;
            font-weight: 900;
        }

        .nav-item { 
            padding: 15px; 
            color: white; 
            border-radius: 8px; 
            margin-bottom: 12px; 
            cursor: pointer; 
            transition: 0.3s; 
            font-weight: 600;
            text-transform: uppercase;
        }

        .nav-item:hover, .active { 
            background-color: #C83803; 
            box-shadow: 0 4px 15px rgba(200, 56, 3, 0.4);
        }

        /* Main Workspace */
        .main { 
            flex-grow: 1; 
            padding: 60px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            background: radial-gradient(circle at center, #152238 0%, #0B162A 100%);
        }

        .card { 
            background-color: #152238; 
            border: 2px solid #C83803; 
            border-radius: 15px; 
            padding: 50px; 
            width: 100%; 
            max-width: 550px; 
            text-align: center; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.7); 
        }

        h2 { color: #C83803; margin-top: 0; font-size: 1.8rem; }

        /* The Sync Button */
        .sync-btn { 
            background-color: #C83803; 
            color: white; 
            border: none; 
            padding: 20px 40px; 
            font-size: 1.3rem; 
            font-weight: bold; 
            border-radius: 10px; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 25px; 
            text-transform: uppercase; 
            letter-spacing: 2px;
            transition: 0.2s;
        }

        .sync-btn:hover { 
            background-color: #FF4500; 
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(255, 69, 0, 0.4);
        }

        #sync-status { 
            display: block; 
            margin-top: 25px; 
            font-size: 1.2rem; 
            font-weight: bold; 
            color: #C83803; 
            letter-spacing: 1px;
        }

        /* Debug Box for real-time updates */
        #debug-log { 
            font-size: 0.75rem; 
            color: #777; 
            margin-top: 30px; 
            text-align: left; 
            background: #000; 
            padding: 12px; 
            border-radius: 8px; 
            height: 70px; 
            overflow-y: auto; 
            font-family: 'Courier New', monospace; 
            border: 1px solid #222; 
        }

        .footer { margin-top: auto; font-size: 0.8rem; color: #334; text-align: center; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h1>JAILEX</h1>
        <div class="nav-item active">Credentials</div>
        <div class="nav-item">Bot Commands</div>
        <div class="nav-item">TTS Settings</div>
        <div class="nav-item">Overlay</div>
        <div class="footer">STREAMING MADE EASY V1.0</div>
    </div>

    <div class="main">
        <div class="card">
            <h2>Bot Integration</h2>
            <p>Sync your Twitch account to activate the <strong>Jailex</strong> auto-login and chat systems.</p>
            
            <button id="sync-button" class="sync-btn">
                Sync Twitch Account
            </button>

            <span id="sync-status">STATUS: OFFLINE</span>
            
            <div id="debug-log">System: Ready for handshake...</div>
        </div>
    </div>

    <script>
        const CLIENT_ID = 'nk06xpus7cc4naiif04xqqamwcf8rz';

        function log(msg) {
            const debug = document.getElementById('debug-log');
            if (debug) debug.innerHTML += `<div>> ${msg}</div>`;
            debug.scrollTop = debug.scrollHeight;
        }

        // --- THE WORKING SYNC LOGIC ---
        document.getElementById('sync-button').onclick = function() {
            log("Opening Twitch Authorization...");
            // Using the EXACT link that worked for the test
            const redirectUri = "https://jailex-h16lm8t8s-justquitbro7s-projects.vercel.app/setup.html";
            const scope = encodeURIComponent('chat:read chat:edit');
            const authUrl = `https://id.twitch.tv/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${redirectUri}&response_type=token&scope=${scope}`;
            
            window.open(authUrl, 'JailexSync', 'width=450,height=600');
        };

        // --- HANDSHAKE LISTENER ---
        window.addEventListener('message', (event) => {
            if (event.data.type === 'TWITCH_TOKEN') {
                const token = event.data.token;
                localStorage.setItem('jailex_token', token);
                log("Token received! Connecting to Twitch...");
                connectBot(token);
            }
        });

        // --- TWITCH API CONNECTION ---
        async function connectBot(token) {
            const status = document.getElementById('sync-status');
            status.innerText = "STATUS: CONNECTING...";
            try {
                const res = await fetch('https://api.twitch.tv/helix/users', {
                    headers: { 'Client-ID': CLIENT_ID, 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                if (data.data && data.data[0]) {
                    const user = data.data[0].display_name;
                    status.innerText = `STATUS: LIVE AS ${user.toUpperCase()}`;
                    status.style.color = "#00FF00"; // Victory Green
                    log(`Successfully linked to ${user}`);
                }
            } catch (err) {
                log("Error: " + err.message);
                status.innerText = "STATUS: SYNC FAILED";
            }
        }

        // --- AUTO-LOGIN ON LOAD ---
        window.onload = () => {
            log("Jailex Master Dashboard Loaded.");
            const savedToken = localStorage.getItem('jailex_token');
            if (savedToken) {
                log("Restoring saved session...");
                connectBot(savedToken);
            }
        };
    </script>
</body>
</html>
