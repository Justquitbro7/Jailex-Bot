<script>
(function() {
    // 1. ATOMIC CAPTURE: Check URL for Twitch Token
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    const twitchToken = params.get('access_token');

    if (twitchToken) {
        localStorage.setItem('twitch_access_token', twitchToken);
        // Wipe the URL fragment immediately so Twitch doesn't see it again
        window.history.replaceState(null, null, window.location.pathname);
    }

    // 2. KICK CAPTURE: Check if we are passing a Kick ID in the URL as well
    const urlParams = new URLSearchParams(window.location.search);
    const kickId = urlParams.get('kick');
    if (kickId) {
        localStorage.setItem('kick_chatroom_id', kickId);
    }

    // 3. VALIDATION: If we have the tokens, hide the login screen immediately
    document.addEventListener('DOMContentLoaded', () => {
        const savedTwitch = localStorage.getItem('twitch_access_token');
        const loginScreen = document.getElementById('login-screen'); // Ensure this ID matches yours
        const dashboard = document.getElementById('main-dashboard');

        if (savedTwitch) {
            if (loginScreen) loginScreen.style.display = 'none';
            if (dashboard) dashboard.style.display = 'block';
            console.log("System: Auth Verified. Initializing Jailex...");
        }
    });
})();
</script>
