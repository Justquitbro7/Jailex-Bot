// --- CONFIG & VERSIONING ---
        const APP_VERSION = "v1.0.0";
        const CLIENT_ID = 'nk06xpus7cc4naiif04xqqamwcf8rz';
        const REDIRECT_URI = "https://jailex-bot.vercel.app/setup.html";
        let socket;

        // --- CORE ENGINE ---
        function wakeVoice() { speak(""); }
        
        function speak(text) {
            if(!text) return;
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.rate = 1.1; // Slight speed boost for "AI" feel
            msg.pitch = 0.9; // Lower pitch for "Command Center" vibe
            window.speechSynthesis.speak(msg);
        }

        function showTab(id, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        // --- CHAT ENGINE (Upgraded with Command Logic) ---
        function connectChat() {
            const token = localStorage.getItem('jailex_t_token');
            const user = localStorage.getItem('jailex_user');
            if(!token || !user) {
                alert("Please Authorize Twitch first!");
                return;
            }
            if(socket) socket.close();
            
            socket = new WebSocket('wss://irc-ws.chat.twitch.tv:443');
            
            socket.onopen = () => {
                socket.send(`PASS oauth:${token}`);
                socket.send(`NICK ${user.toLowerCase()}`);
                socket.send(`JOIN #${user.toLowerCase()}`);
                logToHUD(`[SYSTEM] v1.0 Engine Online. Connected to #${user}`);
                speak("Jaikex v1.0 is now monitoring your broadcast.");
            };

            socket.onmessage = (event) => {
                // Keep-alive check
                if(event.data.includes('PING')) { socket.send('PONG :tmi.twitch.tv'); return; }

                if(event.data.includes('PRIVMSG')) {
                    const parts = event.data.split(' :');
                    const username = parts[0].split('!')[0].substring(1);
                    const msg = parts[1].trim();
                    
                    logToHUD(`<b>${username}:</b> ${msg}`);
                    
                    // --- THE COMMAND PROCESSOR ---
                    processCommands(username, msg);
                }
            };
        }

        function processCommands(user, message) {
            const keywords = JSON.parse(localStorage.getItem('jailex_keywords') || '[]');
            const trigger = message.toLowerCase().split(' ')[0]; // Match first word

            keywords.forEach(item => {
                if(item.cmd.toLowerCase() === trigger) {
                    // 1. Send to Chat (Requires chat:edit scope)
                    sendTwitchMessage(item.resp);
                    // 2. Voice Feedback
                    speak(`Triggered ${item.cmd}. Response sent.`);
                    logToHUD(`<span class="text-orange-500">[TRIGGER] Found ${item.cmd}</span>`);
                }
            });
        }

        async function sendTwitchMessage(msg) {
            if(socket && socket.readyState === WebSocket.OPEN) {
                const user = localStorage.getItem('jailex_user').toLowerCase();
                socket.send(`PRIVMSG #${user} :${msg}`);
            }
        }

        function logToHUD(html) {
            const log = document.getElementById('log');
            log.innerHTML += `<br>${html}`;
            log.scrollTop = log.scrollHeight; // Auto-scroll
        }

        // --- UI & DATA SYNC ---
        function syncUI() {
            const user = localStorage.getItem('jailex_user');
            const kick = localStorage.getItem('jailex_kick_id');
            const k = JSON.parse(localStorage.getItem('jailex_keywords') || '[]');
            
            // Set Version Labels
            document.title = `JAILEX STUDIO | ${APP_VERSION}`;
            document.querySelector('.sidebar .text-white.italic').innerText = APP_VERSION;

            if(user) {
                document.getElementById('t-pill').innerText="ONLINE"; 
                document.getElementById('t-pill').classList.add('status-on');
                document.getElementById('t-btn').classList.add('hidden');
                document.getElementById('t-user').innerText = user.toUpperCase(); 
                document.getElementById('t-user').classList.remove('hidden');
            }
            
            const list = document.getElementById('keyword-list');
            list.innerHTML = k.length ? '' : '<p class="text-center text-slate-700 py-4 italic text-[10px] uppercase">No Commands Saved</p>';
            k.forEach((item, i) => {
                list.innerHTML += `
                    <div class="bg-black/20 p-4 rounded-lg flex justify-between items-center border border-white/5">
                        <span><b class="text-blue-400 font-mono">${item.cmd}</b> <span class="text-slate-500 mx-2">â†’</span> ${item.resp}</span>
                        <button class="text-red-500 font-bold text-[10px] hover:text-red-300" onclick="delK(${i})">REMOVE</button>
                    </div>`;
            });
            document.getElementById('stat-cmds').innerText = k.length;
        }

        // ... [Keep other existing helper functions like startTwitchSync, validateTwitch, etc.]
