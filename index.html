<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jailex v5.3 - Debug Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white p-8">
    <div class="max-w-xl mx-auto bg-slate-900 p-6 rounded-2xl border border-slate-800 shadow-2xl">
        <h1 class="text-xl font-bold text-blue-400 mb-4">Jailex Debug Console <span class="text-xs bg-slate-800 px-2 py-1 rounded ml-2">v5.3</span></h1>
        
        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="bg-black p-3 rounded border border-slate-800">
                <p class="text-[10px] text-slate-500 uppercase">WebSocket</p>
                <p id="ws-status" class="text-yellow-500 font-mono text-sm">INITIALIZING...</p>
            </div>
            <div class="bg-black p-3 rounded border border-slate-800">
                <p class="text-[10px] text-slate-500 uppercase">Audio Engine</p>
                <p id="tts-status" class="text-red-500 font-mono text-sm">LOCKED</p>
            </div>
        </div>

        <button id="unlock-btn" class="w-full bg-blue-600 py-4 rounded-xl font-bold mb-6 hover:bg-blue-500 transition-all">
            1. CLICK TO UNLOCK AUDIO
        </button>

        <div id="debug-log" class="bg-black p-4 h-64 overflow-y-auto rounded border border-slate-800 font-mono text-[11px] text-green-500 space-y-1">
            <p>> System standby...</p>
        </div>
    </div>

    <script>
        // --- HARD-CODED CONFIG ---
        const CHANNEL_ID = "24968498"; // Your Verified Kick ID
        const PUSHER_KEY = "32cbd69e4b950bf97679";
        
        const debugLog = document.getElementById('debug-log');
        const wsStatus = document.getElementById('ws-status');
        const ttsStatus = document.getElementById('tts-status');

        function log(msg) {
            console.log("JAILEX:", msg); // Force to browser console
            const p = document.createElement('p');
            p.innerText = `> ${msg}`;
            debugLog.appendChild(p);
            debugLog.scrollTop = debugLog.scrollHeight;
        }

        // --- 1. TTS UNLOCK ---
        document.getElementById('unlock-btn').addEventListener('click', () => {
            window.speechSynthesis.cancel();
            const utter = new SpeechSynthesisUtterance("Audio system online");
            window.speechSynthesis.speak(utter);
            
            ttsStatus.innerText = "ACTIVE";
            ttsStatus.classList.replace('text-red-500', 'text-green-500');
            log("Audio Engine Unlocked");
        });

        // --- 2. WEBSOCKET CONNECTION ---
        function connect() {
            log("Attempting WebSocket connection...");
            wsStatus.innerText = "CONNECTING...";

            const url = `wss://ws-us2.pusher.com/app/${PUSHER_KEY}?protocol=7&client=js&version=8.4.0-rc2&flash=false`;
            const ws = new WebSocket(url);

            ws.onopen = () => {
                log("Connected to Pusher Server");
                wsStatus.innerText = "CONNECTED";
                wsStatus.classList.replace('text-yellow-500', 'text-green-500');

                // Subscribe to your specific chat
                const subscribeMsg = {
                    event: "pusher:subscribe",
                    data: { channel: `chatrooms.${CHANNEL_ID}.v2` }
                };
                ws.send(JSON.stringify(subscribeMsg));
                log(`Subscribed to Chatroom: ${CHANNEL_ID}`);
            };

            ws.onmessage = (e) => {
                const data = JSON.parse(e.data);
                
                if (data.event === "App\\Events\\ChatMessageEvent") {
                    const chat = JSON.parse(data.data);
                    const user = chat.sender.username;
                    const msg = chat.content;
                    
                    log(`MSG: ${user}: ${msg}`);
                    
                    // SPEAK
                    const utter = new SpeechSynthesisUtterance(`${user} says ${msg}`);
                    window.speechSynthesis.speak(utter);
                }
            };

            ws.onerror = (err) => {
                log("CONNECTION ERROR!");
                wsStatus.innerText = "ERROR";
            };

            ws.onclose = () => {
                log("Connection Lost. Retrying in 5s...");
                wsStatus.innerText = "DISCONNECTED";
                setTimeout(connect, 5000);
            };
        }

        // Auto-start connection
        connect();
    </script>
</body>
</html>
