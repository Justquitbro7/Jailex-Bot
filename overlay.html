<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jailex Overlay v3.0</title>
    <script src="https://js.pusher.com/7.0/pusher.min.js"></script>
    <style>
        body { background: transparent; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; margin: 0; padding: 10px; }
        #chat-container { display: flex; flex-direction: column-reverse; height: 100vh; width: 100%; gap: 8px; }
        .msg { background: rgba(11, 22, 42, 0.85); border-left: 4px solid #FF6A00; padding: 10px; border-radius: 4px; animation: slideIn 0.3s ease; max-width: 90%; }
        .user { font-weight: bold; color: #00F3FF; font-size: 0.9em; margin-bottom: 2px; display: flex; align-items: center; gap: 5px; }
        .platform { font-size: 0.7em; padding: 2px 5px; border-radius: 3px; background: rgba(255,255,255,0.1); }
        .content { font-size: var(--fs); line-height: 1.2; word-break: break-all; }
        @keyframes slideIn { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>
    <div id="chat-container"></div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const twitchChannel = params.get('twitch') || 'justquitbro7';
        const kickId = params.get('kick') || '92474944';
        const fontSize = params.get('size') || '22';
        const stayTime = (params.get('stay') || '20') * 1000;

        document.documentElement.style.setProperty('--fs', fontSize + 'px');

        function addMessage(user, message, platform) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = 'msg';
            div.innerHTML = `
                <div class="user">
                    <span class="platform">${platform}</span>
                    ${user}
                </div>
                <div class="content">${message}</div>
            `;
            container.prepend(div);
            setTimeout(() => { div.style.opacity = '0'; div.style.transition = '1s'; setTimeout(() => div.remove(), 1000); }, stayTime);
        }

        // --- Twitch Connection ---
        const tws = new WebSocket('wss://irc-ws.chat.twitch.tv:443');
        tws.onopen = () => { tws.send('PASS ignore'); tws.send('NICK justinfan' + Math.floor(Math.random()*999)); tws.send('JOIN #' + twitchChannel.toLowerCase()); };
        tws.onmessage = (e) => {
            if(e.data.includes('PRIVMSG')) {
                const u = e.data.split('!')[0].substring(1);
                const m = e.data.substring(e.data.indexOf(':', 1) + 1);
                addMessage(u, m, 'Twitch');
            }
            if(e.data.includes('PING')) tws.send('PONG :tmi.twitch.tv');
        };

        // --- Kick Connection ---
        const pusher = new Pusher('32cbd69e4b950bf97679', { cluster: 'us2' });
        const channel = pusher.subscribe(`chatrooms.${kickId}.v2`);
        channel.bind('App\\Events\\ChatMessageEvent', (data) => {
            addMessage(data.sender.username, data.content, 'Kick');
        });
    </script>
</body>
</html>
