<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Jailex Overlay Lightstream-Safe</title>
    <style>
        body { background: transparent; color: white; font-family: sans-serif; overflow: hidden; margin: 0; padding: 10px; }
        #chat-container { 
            display: block; 
            height: 100vh; 
            width: 100%; 
        }
        .msg { 
            background: rgba(11, 22, 42, 0.95); /* Bears Navy */
            border-left: 5px solid #FF6A00; /* Bears Orange */
            padding: 10px; 
            margin-bottom: 8px;
            border-radius: 4px; 
            width: fit-content;
            max-width: 90%;
            font-size: var(--fs);
        }
        .user { font-weight: bold; color: #00F3FF; font-size: 0.8em; margin-bottom: 2px; }
        .platform { font-size: 0.7em; margin-right: 5px; opacity: 0.7; }
    </style>
</head>
<body>
    <div id="chat-container"></div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const twitchChannel = params.get('twitch') || 'justquitbro7';
        const kickId = params.get('kick') || '92474944';
        const fontSize = params.get('size') || '22';
        const stayTime = (params.get('stay') || '20') * 1000;

        document.documentElement.style.setProperty('--fs', fontSize + 'px');

        function addMessage(user, message, platform) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = 'msg';
            div.innerHTML = '<div class="user"><span class="platform">[' + platform + ']</span>' + user + '</div>' +
                            '<div>' + message + '</div>';
            
            // Add new messages to the TOP
            container.insertBefore(div, container.firstChild);
            
            // Remove after stayTime
            setTimeout(function() {
                div.style.opacity = '0';
                setTimeout(function() { div.remove(); }, 1000);
            }, stayTime);
        }

        // TWITCH
        function connectTwitch() {
            var tws = new WebSocket('wss://irc-ws.chat.twitch.tv:443');
            tws.onopen = function() {
                tws.send('PASS ignore');
                tws.send('NICK justinfan' + Math.floor(Math.random()*999));
                tws.send('JOIN #' + twitchChannel.toLowerCase());
            };
            tws.onmessage = function(e) {
                if(e.data.includes('PRIVMSG')) {
                    var u = e.data.split('!')[0].substring(1);
                    var m = e.data.substring(e.data.indexOf(':', 1) + 1);
                    addMessage(u, m, 'Twitch');
                }
                if(e.data.includes('PING')) tws.send('PONG :tmi.twitch.tv');
            };
            tws.onclose = function() { setTimeout(connectTwitch, 5000); }; // Auto-reconnect
        }

        // KICK
        function connectKick() {
            var kws = new WebSocket('wss://ws-us2.pusher.com/app/32cbd69e4b950bf97679?protocol=7&client=js&version=7.6.0');
            kws.onopen = function() {
                kws.send(JSON.stringify({ event: "pusher:subscribe", data: { channel: "chatrooms." + kickId + ".v2" } }));
                setInterval(function() { kws.send(JSON.stringify({event:"pusher:ping",data:{}})); }, 20000);
            };
            kws.onmessage = function(e) {
                var d = JSON.parse(e.data);
                if (d.event === "App\\Events\\ChatMessageEvent") {
                    var msg = JSON.parse(d.data);
                    addMessage(msg.sender.username, msg.content, 'Kick');
                }
            };
            kws.onclose = function() { setTimeout(connectKick, 5000); }; // Auto-reconnect
        }

        connectTwitch();
        connectKick();

        // TEST MESSAGE - To confirm it's loading in Lightstream
        setTimeout(function() { addMessage('SYSTEM', 'Jailex Loaded Successfully!', 'INFO'); }, 2000);
    </script>
</body>
</html>
