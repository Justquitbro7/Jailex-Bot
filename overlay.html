<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jailex Studio | Unified Overlay</title>
    <style>
        /* Transparent background for streaming */
        body { 
            background-color: rgba(0, 0, 0, 0); 
            margin: 0; 
            padding: 20px; 
            overflow: hidden; 
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        #chat-container {
            display: flex;
            flex-direction: column-reverse;
            height: 95vh;
            width: 400px; /* Standard overlay width */
            gap: 10px;
        }

        .message {
            background: rgba(11, 22, 42, 0.9); /* Jailex Navy */
            border-left: 5px solid #C83803; /* Jailex Orange */
            padding: 10px;
            border-radius: 8px;
            color: white;
            animation: fadeIn 0.3s ease;
            font-size: 18px;
            text-shadow: 1px 1px 2px black;
        }

        .user-name {
            font-weight: bold;
            margin-bottom: 4px;
            display: block;
        }

        /* Platform Badges */
        .badge {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 8px;
            text-transform: uppercase;
        }
        .twitch-badge { background: #6441a5; color: white; }
        .kick-badge { background: #00E701; color: black; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body>

    <div id="chat-container"></div>

    <script>
        // 1. GRAB THE DATA FROM THE URL
        const urlParams = new URLSearchParams(window.location.search);
        const twitchToken = urlParams.get('token');
        const kickId = urlParams.get('kick_id');
        const kickUser = urlParams.get('kick_user') || 'justquitbro7'; // Defaults to you

        const chatContainer = document.getElementById('chat-container');

        // 2. HELPER TO ADD MESSAGES TO SCREEN
        function addMessage(platform, user, text) {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message';
            
            const badgeClass = platform === 'Twitch' ? 'twitch-badge' : 'kick-badge';
            
            msgDiv.innerHTML = `
                <span class="user-name">
                    <span class="badge ${badgeClass}">${platform}</span>${user}
                </span>
                <span class="text">${text}</span>
            `;

            chatContainer.prepend(msgDiv); // Newest messages at the bottom

            // Auto-remove old messages to keep it clean
            if (chatContainer.childNodes.length > 50) {
                chatContainer.removeChild(chatContainer.lastChild);
            }
        }

        // 3. TWITCH CONNECTION (TMI.js logic simplified)
        if (twitchToken) {
            // Using a simple WebSocket for Twitch
            const twitchWS = new WebSocket('wss://irc-ws.chat.twitch.tv:443');

            twitchWS.onopen = () => {
                twitchWS.send(`PASS oauth:${twitchToken}`);
                twitchWS.send(`NICK ${kickUser}`); // Uses your name to connect
                twitchWS.send(`JOIN #${kickUser}`);
            };

            twitchWS.onmessage = (event) => {
                if (event.data.includes('PRIVMSG')) {
                    const parts = event.data.split('!');
                    const user = parts[0].substring(1);
                    const msg = event.data.split(' :')[1];
                    addMessage('Twitch', user, msg);
                }
                // Keep connection alive
                if (event.data.includes('PING')) twitchWS.send('PONG :tmi.twitch.tv');
            };
        }

        // 4. KICK CONNECTION (Using their EventSource or WebSocket)
        if (kickId) {
            // For Kick, we connect to their chatroom ID
            const kickWS = new WebSocket('wss://ws-us2.pusher.com/app/eb1d5f283081a78b932c?protocol=7&client=js&version=7.4.0&flash=false');

            kickWS.onopen = () => {
                const subscribeData = {
                    event: "pusher:subscribe",
                    data: { channel: `chatrooms.${kickId}.v2` }
                };
                kickWS.send(JSON.stringify(subscribeData));
            };

            kickWS.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.event === "App\\Events\\ChatMessageEvent") {
                    const msgData = JSON.parse(data.data);
                    addMessage('Kick', msgData.sender.username, msgData.content);
                }
            };
        }
    </script>
</body>
</html>
